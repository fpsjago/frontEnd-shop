---
import Layout from "../../layouts/Layout.astro";
import ProductShowcase from "../../components/products/ProductShowcase";
import ProductAdminPanel from "../../components/products/ProductAdminPanel";
---

<Layout title="Admin Dashboard | Frontend Shop">
  <h1>ADMIND PANEL</h1>

  <ProductAdminPanel client:load />

</Layout>

<script>
  // Client-side authentication check
  function getTokenFromCookie(): string | null {
    try {
      const cookies = document.cookie.split("; ");
      const tokenCookie = cookies.find(cookie => cookie.startsWith("frontend_shop_token="));
      if (tokenCookie) {
        return decodeURIComponent(tokenCookie.split("=")[1]);
      }
      return null;
    } catch (error) {
      console.warn("[Admin] Failed to read token from cookie:", error);
      return null;
    }
  }

  function checkAuth() {
    const token = getTokenFromCookie();

    if (!token) {
      const baseUrl = import.meta.env.BASE_URL ?? "/";
      const normalizedBase = baseUrl.endsWith("/") ? baseUrl : `${baseUrl}/`;
      window.location.replace(`${normalizedBase}login`);
    }
  }

  // Run auth check immediately
  checkAuth();
</script>
